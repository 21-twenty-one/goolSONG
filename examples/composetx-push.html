<!DOCTYPE html>
<html>
  <head>
    <title>TREZOR Compose & Sign Transaction Test</title>
    <script>

    var backends = { };
    backends['Bitcoin'] = ['https://btc-bitcore3.trezor.io', 'https://btc-bitcore1.trezor.io'];
    backends['Bitcoin Cash'] = ['https://bch-bitcore2.trezor.io'];
    backends['Litecoin'] = ['https://ltc-bitcore1.trezor.io', 'https://ltc-bitcore3.trezor.io'];
    backends['Dash'] = ['https://dash-bitcore1.trezor.io', 'https://dash-bitcore3.trezor.io'];
    backends['Zcash'] = ['https://zec-bitcore1.trezor.io'];
    backends['Testnet'] = ['https://testnet-bitcore4.trezor.io'];

    function trezorComposeTx() {
        var coin = document.getElementById('coin').value;
        var address = document.getElementById('address').value;
        var amount = document.getElementById('amount').value;

        var outputs = [{
            address: address,
            amount: parseInt(amount)
        }];

        TrezorConnect.setBitcoreURLS(backends[coin]);
        TrezorConnect.closeAfterSuccess(false);
        TrezorConnect.composeAndSignTx(outputs, function (response) {
            TrezorConnect.closeAfterSuccess(true);
            if (response.success) {
                TrezorConnect.pushTransaction(response.serialized_tx, function (pushResult) {
                    if (pushResult.success) {
                        console.log('Transaction pushed. Id:', pushResult.txid); // ID of the transaction
                    } else {
                        console.error('Error:', pushResult.error); // error message
                    }
                    document.getElementById("response").innerHTML =  document.getElementById("response").innerHTML + JSON.stringify(pushResult, undefined, 2);
                });
            } else {
                console.error('Error:', response.error); // error message
            }
            document.getElementById("response").innerHTML =  document.getElementById("response").innerHTML + JSON.stringify(response, undefined, 2);
        });
    }

    </script>
  </head>
  <body>
    Coin:
    <select id="coin">
        <option selected>Bitcoin</option>
        <option>Bitcoin Cash</option>
        <option>Litecoin</option>
        <option>Dash</option>
        <option>Zcash</option>
        <option>Testnet</option>
    </select>

    Address: <input type="text" id="address" size="40"
                    value="17RdK7aSerDgahHu858MMRG82ePTQxytc4">
    Satoshis: <input type="number" id="amount" value="20000">

    <button onclick="trezorComposeTx()">Compose & Sign & Push</button>

    <pre id="response"></pre>

    <script src="../connect.js"></script>

  </body>
</html>
