<!DOCTYPE html>
<html>
  <head>
    <title>TREZOR Sign Transaction Test</title>
    <style>
        body, html {
            width: 100%;
            height: 100%;
        }
        textarea {
            width: 100%;
            height: 150px;
            resize: none;
        }
        .textarea-container {
            display: block;
        }
        .textarea {
            width: 40%;
            display: inline-block;
            margin-right: 10px;
        }
    </style>
    <script>

     function trezorSignTx() {
        // TESTNET
        var inputs = [
            // segwit input
            {
                address_n: [49 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 3],
                prev_index: 0,
                prev_hash: "78dbd0d19ccf8776ac590225cde5797e439959d05b91ecdbacd7c244afb28542",
                amount: 36500,
                script_type: 'SPENDP2SHWITNESS'
            },
            // legacy input [compatibile with connect v2, v3]
            // {
            //     address_n: [44 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 2],
            //     prev_index: 0,
            //     prev_hash: "a9b345dd710a1cf4033c0429242d72aa5d00e850ea0e6c4603427333475e4a7e"
            // }
        ];
        var outputs = [
            // segwit change
            {
                address_n: [49 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 4],
                amount: 35000,
                script_type: 'PAYTOP2SHWITNESS'
            },
            // legacy change [compatibile with connect v2, v3]
            // {
            //     address_n: [44 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 0],
            //     amount: 4500, //39100,
            //     script_type: 'PAYTOADDRESS'
            // },
            
            // output
            {
                address: '2NAkTT2szEBPHvMUTGAbDafeLNuJ9Bd5ygi',
                amount: 1000,
                script_type: 'PAYTOADDRESS'
            }
        ];

        TrezorConnect.setBitcoreURLS('https://testnet-bitcore4.trezor.io');
        
        TrezorConnect.signTx(inputs, outputs, function (response) {
            if (response.success) {
                console.log('Serialized TX:', response.serialized_tx); // tx in hex
                console.log('Signatures:', response.signatures); // array of signatures, in hex

                // TrezorConnect.pushTransaction(response.serialized_tx, function (pushResult) {
                //     if (pushResult.success) {
                //         console.log('Transaction pushed. Id:', pushResult.txid); // ID of the transaction
                //     } else {
                //         console.error('Error:', pushResult.error); // error message
                //     }
                //     document.getElementById("response").innerHTML =  document.getElementById("response").innerHTML + JSON.stringify(pushResult, undefined, 2);
                // });

            } else {
                console.error('Error:', response.error); // error message
            }
            document.getElementById("response").innerHTML = JSON.stringify(response, undefined, 2);
        });
     }

    </script>
  </head>
  <body>
    <div class="container">
        <div class="textarea">
            <p>Inputs</p>
            <textarea>[
        {
            address_n: [44 | 0x80000000, 1 | 0x80000000, 0 | 0x80000000, 1, 1],
            prev_index: 0,
            prev_hash: "9f5c356f29552ba8e2fab0dfe7098ec2ba26440c878f70224299b8d6797dd0f7",
            script_type: 'SPENDADDRESS',
            amount: 59390
        }
]</textarea> <!-- whitespace in textarea -->
        </div>
        <div class="textarea">
                <p>Outputs</p>
                <textarea>[
        {
            address_n: [49 | 0x80000000, 1 | 0x80000000, 0 | 0x80000000, 1, 4],
            amount: 64998000, //65000000
            script_type: 'PAYTOP2SHWITNESS' // only for segwit change!!!
        }, {
            address: 'mvRHqUvhXTmpuAHHF4qWtXRYGJuovzRmpb',
            amount: 1000,
            script_type: 'PAYTOADDRESS'
        }
]</textarea> <!-- whitespace in textarea -->
        </div>
    </div>
    
    

    <button onclick="trezorSignTx()">Sign</button>

    <pre id="response"></pre>

    <script src="../connect.js?r=1"></script>

  </body>
</html>
