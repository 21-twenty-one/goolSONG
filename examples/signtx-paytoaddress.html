<!DOCTYPE html>
<html>
  <head>
    <title>TREZOR Sign Transaction Test</title>
    <style>
        body, html {
            width: 100%;
            height: 100%;
        }
        textarea {
            width: 100%;
            height: 150px;
            resize: none;
        }
        .textarea-container {
            display: block;
        }
        .textarea {
            width: 40%;
            display: inline-block;
            margin-right: 10px;
        }
    </style>
    <script>

    // this example requires a device loaded with seed:
    // alcohol woman abuse must during monitor noble actual mixed trade anger aisle

    // Python tests:
    // https://github.com/trezor/python-trezor/blob/master/tests/device_tests/test_msg_signtx.py

    function trezorSignTx() {

        // legacy inputs
        var inp1 = {
            //address_n: [44 | 0x80000000, 0 | 0x80000000, 0 | 0x80000000, 0, 0],
            address_n: [0],
            prev_index: 0,
            prev_hash: "d5f65ee80147b4bcc70b75e4bbf2d7382021b871bd8867ef8fa525ef50864882"
        };

        // legacy outputs
        var out1 = {
            address: '1MJ2tj2ThBE62zXbBYA5ZaN3fdve5CPAz1',
            amount: 390000 - 10000- 80000,
            script_type: 'PAYTOADDRESS'
        }
        var out2 = {
            //address_n: [44 | 0x80000000, 0 | 0x80000000, 0 | 0x80000000, 1, 0],
            address_n: [1],
            amount: 80000,
            script_type: 'PAYTOADDRESS'
        }
        // segwit outputs
        // var out3 = {
        //     address='mhRx1CeVfaayqRwq5zgRQmD7W5aWBfD5mC',
        //     amount=12300000,
        //     script_type=proto_types.PAYTOADDRESS,
        // }
        // var out4 = proto_types.TxOutputType(
        //     address_n=self.client.expand_path("49'/1'/0'/1/0"),
        //     script_type=proto_types.PAYTOP2SHWITNESS,
        //     amount=123456789 - 11000 - 12300000,
        // )
        
        var inputs = [
            // segwit input
            // {
            //     address_n: [49 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 3],
            //     prev_index: 0,
            //     prev_hash: "78dbd0d19ccf8776ac590225cde5797e439959d05b91ecdbacd7c244afb28542",
            //     amount: 36500,
            //     script_type: 'SPENDP2SHWITNESS'
            // },
            
            inp1
        ];
        var outputs = [
            // segwit change
            // {
            //     address_n: [49 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 4],
            //     amount: 35000,
            //     script_type: 'PAYTOP2SHWITNESS'
            // },
            // legacy change
            // {
            //     address_n: [44 | 0x80000000, 1 | 0x80000000, 1 | 0x80000000, 1, 0],
            //     amount: 4500, //39100,
            //     script_type: 'PAYTOADDRESS'
            // },
            
            // output
            out1, out2
        ];

        //TrezorConnect.setCurrency('testnet');
        
        TrezorConnect.signTx(inputs, outputs, function (response) {
            if (response.success) {
                console.log('Serialized TX:', response.serialized_tx); // tx in hex
                console.log('Signatures:', response.signatures); // array of signatures, in hex
            } else {
                console.error('Error:', response.error); // error message
            }
            document.getElementById("response").innerHTML = JSON.stringify(response, undefined, 2);
        });
    }

    </script>
  </head>
  <body>

    <p>This example requires a device loaded with seed:</p>
    <pre>alcohol woman abuse must during monitor noble actual mixed trade anger aisle</pre>

    <button onclick="trezorSignTx()">One output external</button>

    <pre id="response"></pre>

    <script src="../connect.js?r=1"></script>

  </body>
</html>
